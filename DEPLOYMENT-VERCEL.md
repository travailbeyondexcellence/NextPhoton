# Deploying NextPhoton Frontend to Vercel (Mock Data Only)

**Last Updated:** October 2, 2025

This guide will help you deploy the NextPhoton frontend to Vercel using only mock data, **without** connecting to the NestJS backend or PostgreSQL database.

---

## ‚úÖ Prerequisites

- [ ] GitHub/GitLab account
- [ ] Vercel account (free tier is fine)
- [ ] Git repository pushed to GitHub/GitLab
- [ ] Node.js 18+ locally (for testing)

---

## üìã Step-by-Step Deployment Guide

### **Step 1: Prepare Mock Data Files**

Ensure all mock data JSON files exist in the correct location:

```bash
# Check if mock data exists
ls -la frontend/web/src/mockData/

# Expected files:
# - announcements.json
# - dailyStudyPlans.json
# - examinations.json
# - README.md
```

**Action Required:**
- ‚úÖ All API routes should use these JSON files
- ‚úÖ No database connections needed

---

### **Step 2: Disable Database Connections**

Since you're deploying without a database, we need to handle Prisma safely.

#### Option A: Comment Out Prisma Imports (Recommended for Mock Deployment)

**File:** `frontend/web/src/lib/prisma.ts`

```typescript
// Comment out or wrap in conditional
// This prevents build errors when DATABASE_URL is not set

// Only initialize Prisma if DATABASE_URL exists
const prisma = process.env.DATABASE_URL
  ? new PrismaClient()
  : null;

export default prisma;
```

#### Option B: Create a Mock Prisma Client

**File:** `frontend/web/src/lib/prisma.ts`

```typescript
/**
 * Mock Prisma Client for Vercel Deployment (No Database)
 *
 * This file provides a safe fallback when DATABASE_URL is not available.
 * All Prisma operations will return empty results or throw helpful errors.
 */

const createMockPrismaClient = () => {
  return new Proxy({}, {
    get: () => {
      return () => {
        console.warn('Prisma client called but DATABASE_URL not configured. Using mock data instead.');
        return Promise.resolve([]);
      };
    },
  });
};

const prisma = process.env.DATABASE_URL
  ? require('@prisma/client').PrismaClient
  : createMockPrismaClient();

export default prisma;
```

---

### **Step 3: Update Environment Configuration**

**File:** Create `frontend/web/.env.production` (for Vercel)

```bash
# Vercel Production Environment Variables
# These will be set in Vercel dashboard (optional)

# Application URL (will be auto-generated by Vercel)
NEXT_PUBLIC_APP_URL=https://your-app.vercel.app

# Backend API URL (not needed for mock deployment)
# NEXT_PUBLIC_API_URL=http://localhost:963

# Optional: Set to development mode for easier debugging
# NODE_ENV=production
```

**Note:** You can leave this file empty or minimal. Vercel will auto-configure most settings.

---

### **Step 4: Create Vercel Configuration**

**File:** Create `vercel.json` in project root

```json
{
  "version": 2,
  "buildCommand": "cd frontend/web && bun run build",
  "devCommand": "cd frontend/web && bun run dev",
  "installCommand": "bun install",
  "framework": "nextjs",
  "outputDirectory": "frontend/web/.next",
  "regions": ["iad1"],
  "github": {
    "silent": true
  },
  "env": {
    "SKIP_ENV_VALIDATION": "true"
  },
  "build": {
    "env": {
      "SKIP_ENV_VALIDATION": "true"
    }
  }
}
```

---

### **Step 5: Update Package.json Scripts**

Ensure your build scripts are configured correctly.

**File:** `frontend/web/package.json`

Check that you have:
```json
{
  "scripts": {
    "dev": "next dev -p 369",
    "build": "next build",
    "start": "next start",
    "lint": "next lint"
  }
}
```

---

### **Step 6: Configure GraphQL for Mock Data Only**

Your GraphQL is already configured correctly to use local resolvers!

**File:** `frontend/web/src/lib/apollo/client.ts` (Already configured ‚úÖ)

```typescript
// Already pointing to local API route
const httpLink = createHttpLink({
  uri: '/api/graphql', // ‚úÖ Local route, no backend needed
  credentials: 'same-origin',
});
```

**File:** `frontend/web/src/app/api/graphql/route.ts` (Already configured ‚úÖ)

This uses local resolvers from `frontend/web/src/lib/apollo/resolvers.ts`.

---

### **Step 7: Test Build Locally**

Before deploying, test that everything builds correctly:

```bash
# Navigate to frontend directory
cd frontend/web

# Install dependencies
bun install

# Build the project
bun run build

# If build succeeds, test the production build
bun run start

# Open http://localhost:3000 and test:
# - Authentication pages
# - Dashboard pages
# - Mock data loading (educators, announcements, etc.)
```

**Common Build Errors to Fix:**

1. **Prisma errors**: Follow Step 2 to disable/mock Prisma
2. **Environment variable errors**: Set `SKIP_ENV_VALIDATION=true`
3. **Import errors**: Check all imports are from frontend, not backend

---

### **Step 8: Commit and Push Code**

```bash
# From project root
git add .
git commit -m "Prepare frontend for Vercel deployment with mock data"
git push origin Marsha/Deployment
```

---

### **Step 9: Deploy to Vercel**

#### Method A: Vercel Dashboard (Recommended)

1. **Go to Vercel Dashboard**
   - Visit: https://vercel.com/dashboard
   - Click "Add New Project"

2. **Import Git Repository**
   - Select your GitHub/GitLab repository
   - Choose the repository: `NextPhoton`

3. **Configure Project Settings**
   ```
   Framework Preset: Next.js
   Root Directory: frontend/web
   Build Command: bun run build (or leave default)
   Output Directory: .next (default)
   Install Command: bun install
   ```

4. **Environment Variables** (Optional - Leave Empty for Mock Data)
   ```
   No environment variables needed for mock deployment!
   ```

5. **Deploy**
   - Click "Deploy"
   - Wait 2-5 minutes for build
   - Vercel will provide a URL: `https://your-app.vercel.app`

#### Method B: Vercel CLI

```bash
# Install Vercel CLI globally
bun install -g vercel

# Navigate to frontend directory
cd frontend/web

# Login to Vercel
vercel login

# Deploy to preview
vercel

# Deploy to production
vercel --prod
```

---

### **Step 10: Verify Deployment**

After deployment, test these features:

1. **Homepage**
   - Visit your Vercel URL
   - Check if homepage loads

2. **Authentication Pages**
   - Go to `/sign-in`
   - Go to `/sign-up`

3. **Dashboard** (if you have test credentials)
   - Navigate to `/admin/educators`
   - Check if mock data loads

4. **API Routes**
   - Test `/api/announcements`
   - Test `/api/educare-tasks`

5. **GraphQL**
   - Check if Apollo queries work
   - Verify educators list loads

---

## üîß Troubleshooting

### Issue 1: Build Fails with Prisma Error

**Error:**
```
Prisma Client could not locate the Query Engine for runtime "rhel-openssl-3.0.x"
```

**Solution:**
```bash
# Add to frontend/web/package.json
{
  "scripts": {
    "postinstall": "prisma generate || echo 'Skipping Prisma generation'",
    "build": "prisma generate || true && next build"
  }
}
```

Or follow Step 2 to create a mock Prisma client.

---

### Issue 2: Environment Variable Not Found

**Error:**
```
process.env.NEXT_PUBLIC_API_URL is undefined
```

**Solution:**

Update code to use fallbacks:

```typescript
const API_URL = process.env.NEXT_PUBLIC_API_URL || '/api';
const APP_URL = process.env.NEXT_PUBLIC_APP_URL || 'https://nextphoton.vercel.app';
```

Or add to Vercel environment variables (Dashboard ‚Üí Settings ‚Üí Environment Variables).

---

### Issue 3: Mock Data Not Loading

**Error:**
Mock JSON files return 404

**Solution:**

Ensure files are in `frontend/web/src/mockData/` and committed to Git.

Check API routes reference correct path:
```typescript
const DB_FILE_PATH = path.join(process.cwd(), 'src', 'mockData', 'announcements.json');
```

---

### Issue 4: Vercel Function Timeout

**Error:**
```
Task timed out after 10.00 seconds
```

**Solution:**

This shouldn't happen with mock data. If it does:
1. Check for infinite loops in API routes
2. Simplify heavy operations
3. Upgrade Vercel plan (Pro has 60s timeout)

---

### Issue 5: Bun Not Supported on Vercel

**Error:**
```
Bun is not supported
```

**Solution:**

Vercel uses Node.js by default. Update `vercel.json`:

```json
{
  "installCommand": "npm install",
  "buildCommand": "cd frontend/web && npm run build"
}
```

Or keep using `bun` locally and let Vercel use `npm`.

---

## üéØ Post-Deployment Checklist

- [ ] Homepage loads successfully
- [ ] Sign-in/Sign-up pages work
- [ ] Dashboard routes are accessible
- [ ] Mock data loads (educators, announcements, etc.)
- [ ] GraphQL queries return data
- [ ] Theme switching works
- [ ] No console errors in browser
- [ ] Mobile responsive design works
- [ ] All routes are accessible

---

## üöÄ Deployment Workflow

### For Future Updates:

```bash
# 1. Make changes locally
# 2. Test build
cd frontend/web
bun run build

# 3. Commit and push
git add .
git commit -m "Your changes"
git push origin Marsha/Deployment

# 4. Vercel auto-deploys! üéâ
# Check: https://vercel.com/your-username/your-project
```

Vercel will automatically redeploy on every push to your branch.

---

## üìä Vercel Dashboard Settings

### Recommended Settings:

**General:**
- Framework: Next.js
- Root Directory: `frontend/web`
- Node.js Version: 18.x (or latest LTS)

**Build & Development:**
- Build Command: `bun run build` or `npm run build`
- Output Directory: `.next`
- Install Command: `bun install` or `npm install`

**Environment Variables:**
- None required for mock deployment
- Optional: `NEXT_PUBLIC_APP_URL` (auto-set by Vercel)

**Domains:**
- Production: `your-app.vercel.app`
- Add custom domain later if needed

---

## üîê Security Notes

For mock deployment:
- ‚úÖ No sensitive data (no database credentials)
- ‚úÖ No API keys required
- ‚úÖ All data is hardcoded in JSON files
- ‚ö†Ô∏è Authentication is simulated (not production-ready)
- ‚ö†Ô∏è No real user data storage

**When moving to production:**
- Add environment variables for real backend
- Configure proper authentication
- Set up PostgreSQL database
- Add API rate limiting

---

## üìû Support

If you encounter issues:

1. Check Vercel build logs: Dashboard ‚Üí Deployments ‚Üí Click deployment ‚Üí View logs
2. Check browser console for errors
3. Test locally first: `bun run build && bun run start`
4. Review this guide's troubleshooting section

---

## üéâ Success!

Once deployed, your app will be live at:
```
https://your-app-name.vercel.app
```

You can now:
- Share the link with stakeholders
- Test all features with mock data
- Iterate and deploy updates automatically
- Add custom domain when ready

---

**Next Steps After Mock Deployment:**
1. Connect to NestJS backend (when ready)
2. Add PostgreSQL database
3. Implement real authentication
4. Add environment variables for production
5. Set up CI/CD pipeline

**Deployment Complete!** üöÄ
